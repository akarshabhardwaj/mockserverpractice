<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
        }

        #container div {
            border: 2px solid black;
            padding: 12px;
            text-align: center;
        }

        #update_div {
            display: none;
        }
    </style>
</head>

<body>
    <h2>User :-</h2>
    <form>
        <label>Enter First Name</label>
        <input type="text" placeholder="Enter Your First name" id="fname">
        <label>Enter Last Name</label>
        <input type="text" placeholder="Enter Your Last name" id="lname">
        <label>Enter email Name</label>
        <input type="email" placeholder="Enter Your Email name" id="email">
        <label>Enter gender Name</label>
        <input type="text" placeholder="Enter Your gender name" id="gender">
        <input type="submit" value="Add User">
    </form>
    <div id="Update_div">
        <input type="text" placeholder="Enter Updated First name" id="update_name">
        <button id="change">Change</button>
    </div>
    <div id="container"></div>


</body>

</html>
<script>
    let url = "https://mockserverpractice-tk8l.onrender.com/users"

    //CRUD
    //read operation
    async function getData() {
        let res = await fetch(url, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        });
        let data = await res.json();
        // console.log(data);
        appendData(data);
    }
    getData()

    function appendData(data) {
        console.log(data)
        let cont = document.getElementById("container")
        cont.innerHTML = null;
        data.forEach((el, index) => {
            let div = document.createElement("div");
            let h2 = document.createElement("h2");
            let h3 = document.createElement("h3");
            let p = document.createElement("p");


            let btn = document.createElement("button");
            btn.innerText = "Update"
            btn.addEventListener("click", () => {
                document.getElementById("Update_div").style.display = "block";
                UpdateFunction(el.id)
            })

            btn.addEventListener("dblclick", () => {
                document.getElementById("Update_div").style.display = "none";
            })


            h2.innerText = el.first_name + " " + el.last_name;
            h3.innerText = el.email;
            p.innerText = el.gender;
            div.append(h2, h3, p, btn)
            cont.append(div)
        })
    }

    //create operations
    let form = document.querySelector('form');
    form.addEventListener('submit', createData);

    async function createData(e) {
        e.preventDefault();
        let id = Date.now()
        let first_name = document.getElementById("fname").value;
        let last_name = document.getElementById("lname").value;
        let email = document.getElementById("email").value;
        let gender = document.getElementById("gender").value;
        let obj = {
            id, first_name, last_name, email, gender
        }
        try {
            let res = await fetch(url, {
                method: "POST",
                body: JSON.stringify(obj),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            let data = await res.json()
            console.log(res)
            alert("Added Sucessfully")
            getData()
        }
        catch (err) {
            console.log(err)
        }
    }

    //Update operation
    async function UpdateFunction(id) {
        // console.log(id)
        let btn = document.getElementById("change")
        btn.addEventListener("click", () => {
            HandleChange(id)
        })

    }
    async function HandleChange(id) {
        let new_name = document.getElementById("update_name").value;
        // console.log(new_name, id);
        let obj = { first_name: new_name }
        let res = await fetch(`${url}/${id}`, {
            method: "Patch",
            body: JSON.stringify(obj),
            headers: {
                "Content-Type": "application/json"
            }
        })
    }
</script>